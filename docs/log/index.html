<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCEconomy Project Logs</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #e0e0e0;
            background-color: #1a1a1a;
        }
        
        .container {
            display: flex;
            max-width: 1400px;
            margin: 0 auto;
            min-height: 100vh;
        }
        
        .main-content {
            flex: 1;
            padding: 2rem;
            background: #2d2d2d;
            margin-right: 1rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .sidebar {
            width: 300px;
            padding: 2rem 1rem;
            background: #2d2d2d;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            position: sticky;
            top: 2rem;
            height: fit-content;
        }
        
        h1 {
            color: #64b5f6;
            margin-bottom: 1.5rem;
            font-size: 2.5rem;
            border-bottom: 3px solid #42a5f5;
            padding-bottom: 0.5rem;
        }
        
        h2 {
            color: #90caf9;
            margin: 2rem 0 1rem 0;
            font-size: 1.8rem;
        }
        
        h3 {
            color: #64b5f6;
            margin: 1.5rem 0 0.5rem 0;
            font-size: 1.4rem;
        }
        
        .log-entry {
            background: #3d3d3d;
            border-left: 4px solid #42a5f5;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 0 8px 8px 0;
            transition: all 0.3s ease;
        }
        
        .log-entry:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(66, 165, 245, 0.3);
        }
        
        .log-path {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #64b5f6;
            padding: 0.3rem 0.6rem;
            border-radius: 4px;
            font-size: 0.9rem;
            margin-bottom: 1rem;
            display: inline-block;
            text-align: center;
        }
        
        .nav-title {
            font-size: 1.2rem;
            font-weight: bold;
            color: #64b5f6;
            margin-bottom: 1rem;
            border-bottom: 2px solid #42a5f5;
            padding-bottom: 0.5rem;
        }
        
        .nav-list {
            list-style: none;
        }
        
        .nav-item {
            margin-bottom: 0.5rem;
        }
        
        .nav-link {
            display: block;
            padding: 0.5rem 0.8rem;
            background: #404040;
            color: #e0e0e0;
            text-decoration: none;
            border-radius: 4px;
            transition: all 0.3s ease;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }
        
        .nav-link:hover {
            background: #42a5f5;
            color: #1a1a1a;
            transform: translateX(3px);
        }
        
        .nav-link.active {
            background: #1976d2;
            color: #ffffff;
        }
        
        .loading {
            text-align: center;
            padding: 2rem;
            color: #9e9e9e;
        }
        
        .error {
            background: #e74c3c;
            color: white;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
        }
        
        .markdown-content h1 { font-size: 2rem; margin: 1.5rem 0; color: #64b5f6; }
        .markdown-content h2 { font-size: 1.5rem; margin: 1.2rem 0; color: #90caf9; }
        .markdown-content h3 { font-size: 1.2rem; margin: 1rem 0; color: #64b5f6; }
        .markdown-content ul { margin-left: 1.5rem; margin-bottom: 1rem; }
        .markdown-content li { margin-bottom: 0.3rem; }
        .markdown-content strong { color: #90caf9; }
        .markdown-content code { 
            background: #1a1a1a; 
            color: #64b5f6;
            padding: 0.2rem 0.4rem; 
            border-radius: 3px; 
            font-family: 'Courier New', monospace;
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                position: relative;
                top: 0;
            }
            .main-content {
                margin-right: 0;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <main class="main-content">
            <h1>MCEconomy Project Logs</h1>
            <div id="logs-container">
                <div class="loading">Loading logs...</div>
            </div>
        </main>
        
        <aside class="sidebar">
            <div class="nav-title">Latest Logs</div>
            <nav>
                <ul id="nav-list" class="nav-list">
                    <li><div class="loading">Loading navigation...</div></li>
                </ul>
            </nav>
        </aside>
    </div>

    <script>
        class LogViewer {
            constructor() {
                this.logs = [];
                this.currentLog = null;
                this.init();
            }
            
            async init() {
                try {
                    await this.loadLogs();
                    this.renderNavigation();
                    this.renderLogs();
                } catch (error) {
                    this.showError('Failed to load logs: ' + error.message);
                }
            }
            
            async loadLogs() {
                try {
                    // Discover log directories by fetching the log structure
                    const logPaths = await this.discoverLogPaths();
                    
                    for (const path of logPaths) {
                        try {
                            const content = await this.loadLogContent(path);
                            this.logs.push({
                                path: path,
                                content: content,
                                timestamp: this.parseTimestamp(path)
                            });
                        } catch (error) {
                            console.warn(`Failed to load log ${path}:`, error);
                        }
                    }
                    
                    // Sort logs by timestamp (newest first)
                    this.logs.sort((a, b) => b.timestamp - a.timestamp);
                } catch (error) {
                    console.error('Failed to discover log paths:', error);
                    // Fallback to known path
                    await this.loadFallbackLog();
                }
            }
            
            async loadLogContent(path) {
                try {
                    // Fetch the actual log file content
                    const response = await fetch(`./${path}/logs.md`);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return await response.text();
                } catch (error) {
                    console.error(`Failed to load log ${path}:`, error);
                    throw error;
                }
            }
            
            async discoverLogPaths() {
                try {
                    // Try to discover log directories by checking common patterns
                    const potentialPaths = [
                        '2026/0/3/3'
                    ];
                    
                    const validPaths = [];
                    
                    // Check each potential path to see if logs.md exists
                    for (const path of potentialPaths) {
                        try {
                            const response = await fetch(`./${path}/logs.md`, { method: 'HEAD' });
                            if (response.ok) {
                                validPaths.push(path);
                            }
                        } catch (error) {
                            // Path doesn't exist, skip it
                            console.debug(`Path ${path} not found`);
                        }
                    }
                    
                    // Also try to discover any additional logs by checking common date patterns
                    const years = ['2026'];
                    const months = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11'];
                    const days = ['1', '2', '3', '4', '5', '6', '7', '8', '9', '10', '11', '12', '13', '14', '15', '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31'];
                    const iterations = ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9'];
                    
                    for (const year of years) {
                        for (const month of months) {
                            for (const day of days) {
                                for (const iteration of iterations) {
                                    const path = `${year}/${month}/${day}/${iteration}`;
                                    if (!potentialPaths.includes(path)) {
                                        try {
                                            const response = await fetch(`./${path}/logs.md`, { method: 'HEAD' });
                                            if (response.ok) {
                                                validPaths.push(path);
                                            }
                                        } catch (error) {
                                            // Path doesn't exist, skip it
                                        }
                                    }
                                }
                            }
                        }
                    }
                    
                    return validPaths;
                } catch (error) {
                    console.error('Failed to discover log paths:', error);
                    return ['2026/0/3/3']; // Fallback to original
                }
            }
            
            async loadFallbackLog() {
                try {
                    const content = await this.loadLogContent('2026/0/3/3');
                    this.logs.push({
                        path: '2026/0/3/3',
                        content: content,
                        timestamp: this.parseTimestamp('2026/0/3/3')
                    });
                } catch (error) {
                    throw new Error('No logs available and fallback failed');
                }
            }
            
            parseTimestamp(path) {
                const parts = path.split('/');
                const year = parseInt(parts[0]);
                const month = parseInt(parts[1]);
                const day = parseInt(parts[2]);
                const iteration = parseInt(parts[3]);
                return new Date(year, month, day, iteration * 6).getTime();
            }
            
            renderNavigation() {
                const navList = document.getElementById('nav-list');
                navList.innerHTML = '';
                
                this.logs.forEach((log, index) => {
                    const li = document.createElement('li');
                    li.className = 'nav-item';
                    
                    const a = document.createElement('a');
                    a.href = '#';
                    a.className = 'nav-link';
                    if (index === 0) a.classList.add('active');
                    a.textContent = log.path;
                    a.onclick = async (e) => {
                        e.preventDefault();
                        await this.selectLog(log.path);
                    };
                    
                    li.appendChild(a);
                    navList.appendChild(li);
                });
            }
            
            renderLogs() {
                const container = document.getElementById('logs-container');
                
                if (this.logs.length === 0) {
                    container.innerHTML = '<div class="error">No logs found</div>';
                    return;
                }
                
                // Display the latest log by default
                this.displayLog(this.logs[0]);
            }
            
            async selectLog(path) {
                // Check if log is already loaded
                let log = this.logs.find(l => l.path === path);
                
                if (!log) {
                    // Load the log dynamically
                    try {
                        const content = await this.loadLogContent(path);
                        log = {
                            path: path,
                            content: content,
                            timestamp: this.parseTimestamp(path)
                        };
                        this.logs.push(log);
                        
                        // Re-sort logs by timestamp
                        this.logs.sort((a, b) => b.timestamp - a.timestamp);
                        
                        // Re-render navigation to include new log
                        this.renderNavigation();
                    } catch (error) {
                        this.showError(`Failed to load log ${path}: ${error.message}`);
                        return;
                    }
                }
                
                this.displayLog(log);
                
                // Update active state in navigation
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                    if (link.textContent === path) {
                        link.classList.add('active');
                    }
                });
            }
            
            displayLog(log) {
                const container = document.getElementById('logs-container');
                const pathParts = log.path.split('/');
                const datePath = `${pathParts[0]}/${pathParts[1]}/${pathParts[2]}`;
                const iteration = pathParts[3];
                
                container.innerHTML = `
                    <div class="log-entry">
                        <div class="log-path">
                            <div>${datePath}</div>
                            <div style="font-size: 0.8rem; margin-top: 0.2rem; opacity: 0.8;">Iteration ${iteration}</div>
                        </div>
                        <div class="markdown-content">
                            ${this.markdownToHtml(log.content)}
                        </div>
                    </div>
                `;
            }
            
            markdownToHtml(markdown) {
                return markdown
                    .replace(/^# (.*$)/gim, '<h1>$1</h1>')
                    .replace(/^## (.*$)/gim, '<h2>$1</h2>')
                    .replace(/^### (.*$)/gim, '<h3>$1</h3>')
                    .replace(/^\*\*(.*)\*\*/gim, '<strong>$1</strong>')
                    .replace(/^\- (.*$)/gim, '<li>$1</li>')
                    .replace(/(<li>.*<\/li>)/s, '<ul>$1</ul>')
                    .replace(/`([^`]+)`/g, '<code>$1</code>')
                    .replace(/\n\n/g, '</p><p>')
                    .replace(/^/, '<p>')
                    .replace(/$/, '</p>');
            }
            
            showError(message) {
                document.getElementById('logs-container').innerHTML = 
                    `<div class="error">${message}</div>`;
                document.getElementById('nav-list').innerHTML = 
                    '<li><div class="error">Failed to load navigation</div></li>';
            }
        }
        
        // Initialize the log viewer when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            new LogViewer();
        });
    </script>
</body>
</html>
